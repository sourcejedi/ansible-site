- hosts: test-vm-debian
  roles:
    - role: repos_apt
      repos_apt_proxy: 'http://silo.carrier.duckdns.org:3142/'

    - sourcejedi.etckeeper
    - users
    - sourcejedi.systemd-journal

    - role: systemd-coredump
      when: ansible_distribution == "Debian"

    - sourcejedi.atop

    - openssh-server

    - sourcejedi.disable_unwanted_servers

    # Note UFW automatically allows DHCPv6, mDNS,
    # and minissdpd (unsafe uPnP client daemon).
    - role: Oefenweb.ufw
      ufw_etc_default_default_input_policy: REJECT
      ufw_default_incoming_policy: reject
      ufw_rules:
        - comment: 'ssh'
          rule: allow
          protocol: tcp
          to_port: 22

    - packages-cli-basics
    - packages-dev-basics
    - sourcejedi.ccache

    - remove-mlocate-on-deb

    # ubuntu1804.  Remember to update role if any other version is used.
    - role: ubuntu-gnome-remove-snaps
      ubuntu_gnome_remove_snapd: yes
      when: ansible_distribution == "Ubuntu"

    #
    # Roles which are not always used, or mostly used to test the role itself
    #

    - sourcejedi.cups

    # relied upon for daily-borgbackup and daily-rsync (cron mail).
    - deb-mail

    - packages-gui
    - sourcejedi.libvirt_nss

    - jpegcheck

    - jenkins-photos

    - { role: daily-borgbackup,
              daily_borgbackup__cron_prefix: '50-' }

    ## Test using debian10-vm as both the client and the server.
    - { role: daily-rsync,
              daily_rsync__cron_prefix: '60-' }
