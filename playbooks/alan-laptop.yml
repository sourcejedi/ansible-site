- hosts: alan-laptop
  roles:
    - repos-fedora

    - sourcejedi.etckeeper
    - remove-rpcbind
    - sourcejedi.hdparm-noapm
    - users
    - sourcejedi.systemd-journal

    - systemd-coredump

    # This works ok, though it doesn't mark the file
    # as modified automatically by ansible
    - role: Oefenweb.sysctl
      sysctl_settings:
        #
        # https://fedoraproject.org/wiki/QA/Sysrq
        #
        # Fedora disables sysrq by default.
        # It's slightly more powerful than some people are comfortable with
        # granting to not-logged-in users :).
        # But I want it.
        #
        - name: kernel.sysrq
          value: 1

    # Linus' hack to reduce dirty_bytes.  Assumes we have 1GB+ ram.
    # This might reduce latencies in certain situations.
    # You might want higher values if you have faster storage.
    # - https://lwn.net/Articles/572911/ "USB-stick stall problem".
    #
    # On the flipside, it can cause worse layout i.e. fragmentation.
    # - https://www.mail-archive.com/linux-kernel@vger.kernel.org/msg531225.html
    #
    #- role: Oefenweb.sysctl
    #  sysctl_settings:
    #    - name: vm.dirty_bytes
    #      value: 180000000
    #    - name: vm.dirty_background_bytes
    #      value:  90000000

    # Useful to log memory usage per process (default 10 min snapshots).
    - sourcejedi.atop

    # My Dell Latitude E5450 seems ok with `powertop --auto-tune`.
    #
    # except that it causes occasional hangs soon after resume
    # (test period: 1-3 weeks)
    #
    # re-happened now?
    # 2017-12-16  4.14.3-300.fc27  2017-12-11 
    # previous    4.13.16-302.fc27  2017-12-02
    #
    # ALPM is still disabled
    #
    #- powertop-full-override

    - remove-mlocate-on-fedora
    - packages-trash-cli
    - jpegcheck

    - packages-gui

    # In case you want to test remove+install of google-chrome.
    #- sourcejedi.google-chrome-remove

    - packages-dev-basics
    - sourcejedi.ccache

    - sourcejedi.rpmfusion-free  # e.g. codecs beyond mp3

    # nonfree, useful at least to keep the repo keys updated for other users.
    #- sourcejedi.rpmfusion-nonfree
    - { role: sourcejedi.rpmfusion-remove, repo: nonfree }

    - sourcejedi.nspawn-on-fedora

    - { role: bfq, bfq: false }
