# Usage looks like this:
#
# cp -av ansible/ jessie/
#
# # Enter container with default settings - use host network
# # (NOTE this also requires DNS setup in etc/resolv.conf,
# #  and I'm not sure what is setting that up when I do this)
# systemd-nspawn -D jessie --settings=no
# cd /ansible
#
# # install ansible
# bootstrap/debian jessie &&
#
# # Double-check ansible dependencies
# ./localhost jessie playbooks/all-bootstrap.yml &&
#
# # Prepare system for boot & login, including a DHCP client
# ./localhost jessie playbooks/test-nspawn-deb-bootstrap.yml
#
# passwd alan-sysop
# exit
#
# # Boot in separate network namespace
# systemd-nspawn -D jessie -b --network-veth
# ...
#
# # sometimes I've had to set hostname manually, I don't know why
# hostnamectl set-hostname jessie
#
# # Run this playbook
# cd /ansible
# ./localhost jessie playbooks/test-nspawn-deb.yml
#

- include: test-nspawn-deb-bootstrap.yml

# Tasks to run in booted container
# (e.g. which start services).
- hosts: test-nspawn-deb
  roles:
    - sourcejedi.systemd-journal
    - openssh-server

    # needs fixing
    #- debian-unattended-upgrades

    #- polipo
    #- apt-cacher-ng

    #conflict with systemd-journal role
    #- rsyslog-srv

    #puts load on external servers
    #- smokeping
    #- icinga2
